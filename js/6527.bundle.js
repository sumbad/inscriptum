"use strict";(self.webpackChunkinscriptum=self.webpackChunkinscriptum||[]).push([[6527,2940,5708],{2940:(t,e,o)=>{o.r(e),o.d(e,{EditorTooltipComponent:()=>a});var i=o(745),n=o(3445),s=o(6201),l=o(9935),r=function(t,e,o,i){var n,s=arguments.length,l=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(l=(s<3?n(l):s>3?n(e,o,l):n(e,o))||l);return s>3&&l&&Object.defineProperty(e,o,l),l};let a=class extends i.yB{constructor(){super(s.Z,!1),this.html=n.dy,this.formatTTOptions={padding:10,position:l.browser.mobile?"bottom":"top",minDelta:5}}get linkTTOptions(){return{padding:7,position:"bottom",depend:this.$tl_tooltip,dependPadding:10}}connectedCallback(){super.connectedCallback(),this.$tl_link_tooltip=this.querySelector("#_tl_link_tooltip")||document.createElement("div"),this.$tl_tooltip=this.querySelector("#_tl_tooltip")||document.createElement("div"),this.$tl_blocks=this.querySelector("#_tl_blocks")||document.createElement("div"),this.$bold_button=this.querySelector("#_bold_button")||document.createElement("div"),this.$italic_button=this.querySelector("#_italic_button")||document.createElement("div"),this.$link_button=this.querySelector("#_link_button")||document.createElement("div"),this.$header_button=this.querySelector("#_header_button")||document.createElement("div"),this.$subheader_button=this.querySelector("#_subheader_button")||document.createElement("div"),this.$quote_button=this.querySelector("#_quote_button")||document.createElement("div"),this.$strikeButton=this.querySelector("#_strike_button")||document.createElement("div"),this.$image_button=this.querySelector("#_image_button")||document.createElement("div"),this.$embed_button=this.querySelector("#_embed_button")||document.createElement("div")}render(){return this.html`
      <div id="_tl_link_tooltip" class="tl_link_tooltip"></div>
      <div id="_tl_tooltip" class="tl_tooltip" @mouseover=${this.handleMouseover.bind(this)} @mouseout=${this.handleMouseout.bind(this)}>
        <div class="buttons">
          <span class="button_hover"></span>
          <div class="button_group">
            <button id="_bold_button"></button>
            <button id="_italic_button"></button>
            <button id="_link_button"></button>
          </div>
          <div class="button_group">
            <button id="_header_button"></button>
            <button id="_subheader_button"></button>
            <button id="_quote_button"></button>
          </div>
          <div class="button_group">
            <button id="_strike_button" class="tt-icon-btn">
            ${n.YP`
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-strikethrough" width="24" height="24" viewBox="0 0 24 24" stroke-width="1" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <line x1="5" y1="12" x2="19" y2="12" />
              <path d="M16 6.5a4 2 0 0 0 -4 -1.5h-1a3.5 3.5 0 0 0 0 7" />
              <path d="M16.5 16a3.5 3.5 0 0 1 -3.5 3h-1.5a4 2 0 0 1 -4 -1.5" />
            </svg>
              `}
            </button>
          </div>
        </div>
        <div class="prompt">
          <span class="close"></span>
          <div class="prompt_input_wrap"><input type="url" class="prompt_input" /></div>
        </div>
      </div>
      <div id="_tl_blocks" class="tl_blocks">
        <div class="buttons">
          <button id="_image_button"></button>
          <button id="_embed_button"></button>
        </div>
      </div>
    `}handleMouseover(t){let e=t.target;t instanceof MouseEvent&&"BUTTON"==(null==e?void 0:e.tagName)&&!e.classList.contains("disabled")&&(this.$tl_tooltip.setAttribute("data-hover",e.id),this.$tl_tooltip.classList.add("hover"),setTimeout((()=>{this.$tl_tooltip.classList.add("hover_anim")}),1),clearTimeout(this.$tl_tooltip.to))}handleMouseout(t){"BUTTON"==t.target.tagName&&(this.$tl_tooltip.classList.remove("hover"),this.$tl_tooltip.to=setTimeout((()=>{this.$tl_tooltip.classList.remove("hover_anim")}),70))}tooltipUpdatePosition(t,e,o,i){if(o=o||{padding:10,position:"top"},null==(e=e||t._range||null))return;let n=i.getBounds(e),s=i.container.getBoundingClientRect(),l={width:t.offsetWidth,height:t.offsetHeight},r=window.outerWidth,a=window.outerHeight,d=document.body.scrollTop,c=9,u=d+9,h=r-l.width-9,p=d+a-l.height-9;l.left=n.left+n.width/2-l.width/2;let _,m=s.left+l.left;if(m<c?l.left=c-s.left:m>h&&(l.left=h-s.left),"top"==o.position){l.top=n.top-l.height-o.padding,_=!1,s.top+l.top<u&&(l.top=n.bottom+o.padding,_=!0)}else if("bottom"==o.position){let t=!1;l.top=n.bottom+o.padding,(t=this.isOverElement(l,o.depend,o.dependPadding))&&(l.top=t.bottom+o.dependPadding),_=!0,s.top+(l.top||0)>p&&(l.top=n.top-l.height-o.padding,(t=this.isOverElement(l,o.depend,o.dependPadding))&&(l.top=t.top-l.height-o.dependPadding),_=!1)}l.left=Math.round(l.left),l.top=Math.round(l.top||0),t._range=e,o.minDelta&&Math.abs(l.left-t._left)<o.minDelta&&Math.abs(l.top-t._top)<o.minDelta||(t._left=l.left,t._top=l.top,t.style.left=l.left+"px",t.style.top=l.top+"px",t.classList.toggle("bottom",_))}isOverElement(t,e,o){if(!e||!e.classList.contains("shown"))return!1;t.bottom=t.top+t.height,t.right=t.left+t.width;let i={_left:e.offsetLeft,_top:e.offsetTop},n={top:i._top,bottom:i._top+e.offsetHeight,left:i._left,right:i._left+e.offsetWidth};return!(t.left-n.right>=o||n.left-t.right>=o||t.top-n.bottom>=o||n.top-t.bottom>=o)&&n}hideBlocksTooltip(){this.$tl_blocks.classList.remove("shown")}showFormatTooltip(t,e,o){o&&(this.$tl_tooltip.classList.remove("tooltip_prompt"),this.tooltipUpdatePosition(this.$tl_tooltip,t,this.formatTTOptions,e),this.$tl_tooltip.classList.contains("move_anim")||setTimeout((()=>{this.$tl_tooltip.classList.add("move_anim")}),10),this.$tl_tooltip.classList.contains("shown")?this.tooltipUpdatePosition(this.$tl_link_tooltip,null,this.linkTTOptions,e):setTimeout((()=>{this.$tl_tooltip.classList.add("shown"),this.tooltipUpdatePosition(this.$tl_link_tooltip,null,this.linkTTOptions,e)}),10))}hideFormatTooltip(t){this.$tl_tooltip.classList.remove("move_anim","shown"),this.tooltipUpdatePosition(this.$tl_link_tooltip,null,this.linkTTOptions,t)}showBlocksTooltip(t,e,o){e&&(this.$tl_blocks.classList.add("shown"),this.blocksUpdatePosition(t,o))}blocksUpdatePosition(t,e){if(void 0===t&&(t=e.getSelection()),null==t||!e)return;let o=e.getBounds(t);this.$tl_blocks.style.top=o.top+o.height/2+"px"}showLinkTooltip(t,e,o,i){if(!o)return;let n={index:t.offset(i.scroll),length:t.length()};this.$tl_link_tooltip.textContent=e,this.tooltipUpdatePosition(this.$tl_link_tooltip,n,this.linkTTOptions,i),this.$tl_link_tooltip.classList.contains("move_anim")||setTimeout((()=>{this.$tl_link_tooltip.classList.add("move_anim")}),1),this.$tl_link_tooltip.classList.contains("shown")||setTimeout((()=>{this.$tl_link_tooltip.classList.add("shown")}),10)}hideLinkTooltip(t){this.$tl_link_tooltip.classList.remove("move_anim","shown")}};a=r([(0,i.Qr)("inscriptum-editor-tooltip")],a)},6527:(t,e,o)=>{o.r(e),o.d(e,{EditorComponent:()=>S});var i=o(8947),n=o(1417),s=o(1436),l=o(745),r=o(6201),a=o(3445),d=o(5161),c=o.n(d),u=o(8895),h=o.n(u),p=o(9233),_=o(1966),m=o(4615),g=o(9935),b=o(2940),f=o(5708),v=o(4938),y=o(6136),$=o(6885),w=o(6449),k=o(3507),T=o(7012),q=function(t,e,o,i){var n,s=arguments.length,l=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(l=(s<3?n(l):s>3?n(e,o,l):n(e,o))||l);return s>3&&l&&Object.defineProperty(e,o,l),l},P=function(t,e,o,i){return new(o||(o=Promise))((function(n,s){function l(t){try{a(i.next(t))}catch(t){s(t)}}function r(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(l,r)}a((i=i.apply(t,e||[])).next())}))};(0,T.s)("loading-progress-bar"),i.vI.add(s.ca9,s.c_t,s.cJz,s.nNP,s.Elr,s.gHg,s._jT,s.zc,n.mdU,s.Kl4,s.r8p,s.dT$);let S=class extends l.yB{constructor(){super(r.Z,!1),this.styles=a.dy`
    <style>
      ${o(898)}
    </style>
  `,this.tooltip=new b.EditorTooltipComponent,this.isPreloader=!0,this.isPosted=!1,this.loadingRef={current:{}},this.changedContent$=new p.X(null),(0,v.X7)("/css/custom_editor_fonts.css"),this._storageService=new _.V;const t=this.isPosted?`${document.location.origin}/notes`:`${document.location.origin}/drafts`;this._authService=new m.e(this._storageService,t)}set flag(t){"posted"===t&&(this.isPosted=!0)}connectedCallback(){super.connectedCallback(),i.vz.watch();const t=this.querySelector("#_tl_editor");this.quill=g.editor(this.tooltip,t),this.quill.disable(),this._authService.$authenticated.getValue()?this.loadContent(this.quill):this._authService.$authenticated.subscribe((t=>{null!==t&&this.quill&&(t?this.loadContent(this.quill):this.isPosted?c()("/notes"):c()("/notes/drafts"))}));const e=document.title,o=`*${e}`;var n=new(h());this.quill.on("text-change",(t=>{this.isPreloader||(n=n.compose(t),this.changedContent$.next(this.quill.getContents()),document.title!==o&&(document.title=o))}));let s=!1;this.changedContent$.pipe((0,w.T)(2),(0,k.b)(1e4)).subscribe((t=>{var o,i,l;if(null!==t&&!this.isPosted){const r=null!==(o=this.loadingRef.current.togglePause)&&void 0!==o?o:t=>console.log(`Toggle loading pause to ${t}`);let a=2e3;if(s&&(null===(i=this.loadingRef.current.generateProgress)||void 0===i||i.next()),s=!0,this._storageService.api.page.updateById(this.pageId,t).then((()=>{n=new(h()),s=!1,r(!1),setTimeout((()=>{var t;null===(t=this.loadingRef.current.generateProgress)||void 0===t||t.next()}),a>0?a:0),document.title=e})),void 0!==this.loadingRef.current.togglePause&&void 0!==this.loadingRef.current.generateProgress){let t=null===(l=this.loadingRef.current.generateProgress)||void 0===l?void 0:l.next();void 0!==t&&1===t.value&&(setTimeout((()=>{s&&(r(!0),a-=300)}),300),setTimeout((()=>{s&&r(!1)}),1e3),setTimeout((()=>{s&&(r(!0),a-=1e3)}),2e3),setTimeout((()=>{s&&(a-=1e3)}),3e3))}}})),window.onbeforeunload=function(){if(n.length()>0)return"There are unsaved changes. Are you sure you want to leave?"}}disconnectedCallback(){window.onbeforeunload=null,this.quill=null}render(){return(0,f.default)({isPreloader:this.isPreloader,styles:this.styles,tooltip:this.tooltip,loaderConfig:{duration:2e3,stepsCount:1},loadingRef:this.loadingRef},{publish:this.publish.bind(this)})}loadContent(t){var e,o;return P(this,void 0,void 0,(function*(){let i;if(this.isPosted){const t=yield this._storageService.api.note.findById(this.id);if(null==(null===(e=t.draft)||void 0===e?void 0:e.pages[0]))throw new Error(`Can't find a draft for note with ID ${this.id}`);i=null===(o=t.draft)||void 0===o?void 0:o.pages[0],this.id=t.draft.id}else{const t=yield this._storageService.api.draft.findById(this.id);i=t.pages[0],Array.isArray(t.notes)&&null!=t.notes[0]&&(this.noteId=t.notes[0].id,this.isPosted=!0)}this.pageId=i.id,t.setContents(i.content),t.history.clear(),t.enable(),this.isPreloader=!1}))}publish(){return P(this,void 0,void 0,(function*(){if(null==this.quill)return;let t=document.querySelector(".tl_article"),e=document.querySelector(".tl_article_header"),o=document.querySelector(".tl_article_content");if(t.classList.contains("tl_article_saving"))return!1;let i=o.querySelector("h1").textContent||"";if(i.length<2){clearTimeout(t.to),t.classList.add("title_required"),t.to=setTimeout((()=>{t.classList.remove("title_required")}),3e3),this.quill.focus();let[e]=this.quill.scroll.descendants($.TitleBlot,0,this.quill.scroll.length());return this.quill.setSelection(e.offset(),e.length()-1),(0,y.showError)("Title is too small")}if(i=i.trim(),o.querySelectorAll('img[src^="data:"],video[src^="data:"]').length)return(0,y.showError)("Upload in progress.\nPlease wait...");if((0,y.getPageContent)(!1,this.quill).length>65536)return(0,y.showError)("Content is too big");(0,y.updateEditable)(!1,this.quill,this.tooltip,t,o,e);let n="";const s=this._removeElementsBySelectors(document.querySelector(".tl_page_wrap"),["article .ql-editor h1","article .ql-editor address","article .ql-clipboard","#_tl_link_tooltip","#_tl_tooltip","#_tl_blocks","inscriptum-editor-tooltip","aside .account_top","aside .publish_button","aside .account_bottom","aside .error_msg"]);if(t.classList.add("tl_article_saving"),null===s)return t.classList.remove("tl_article_saving"),(0,y.showError)("Content cannot be empty");const l=this.quill.getContents(),{description:r,image:a}=(0,v.Ro)(l),d=(0,v.u)(i).replace(/[^a-zA-Z0-9-_]/g,"-");let c;yield this._storageService.api.page.updateById(this.pageId,l),this.isPosted?c=yield this._storageService.api.note.updateById(this.noteId,d,{title:i,description:r,image:a},`note/${d}`):(c=yield this._storageService.api.note.create(this._storageService.author.id,d,this.id,{title:i,description:r,image:a},`note/${d}`),(0,y.draftClear)()),this.isPosted=!0,this.noteId=c.id,t.classList.remove("tl_article_saving"),(0,y.updateEditable)(!0,this.quill,this.tooltip,t,o,e),null!==s&&(s.querySelector("#_edit_button").href=`/draft/${this.id}`,n=s.outerHTML);const u=`  \n<html>\n  <head>\n    <meta charset="utf-8">\n    <title>${i}</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">\n    <meta name="format-detection" content="telephone=no">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="MobileOptimized" content="176">\n    <meta name="HandheldFriendly" content="True">\n    <meta name="robots" content="index, follow">\n    <meta name="description" content="${r}">\n    <meta property="og:site_name" content="inscriptum">\n    <meta property="og:type" content="article">\n    <meta property="og:title" content="${i}">\n    <meta property="og:description" content="${r}">\n    <meta property="og:image" content="${a}">\n    <meta property="article:published_time" content="${c.created_at}">\n    <meta property="article:modified_time" content="${c.updated_at}">\n    <meta property="article:author" content="${this._storageService.author.name||this._storageService.author.email}">\n    <meta name="twitter:card" content="summary">\n    <meta name="twitter:title" content="${i}">\n    <meta name="twitter:description" content="${r}">\n    <meta name="twitter:image" content="${a}">\n    <link rel="shortcut icon" type="image/png" href="favicon.png">\n    <link href="/css/note.css" rel="stylesheet">\n    <link href="/css/custom_editor_fonts.css" rel="stylesheet">\n  </head>\n  <body>\n    ${n}\n  </body>\n  <script type="text/javascript" src="/js/note.js"><\/script>\n</html>`,h=document.createElement("a"),p=new Blob([u],{type:"application/octet-stream"});h.href=window.URL.createObjectURL(p),h.download=`${d}.html`,h.click()}))}_removeElementsBySelectors(t,e){if(null===t)return null;const o=t.cloneNode(!0);return e.forEach((t=>{const e=o.querySelector(t);e&&e.remove()})),o}};q([(0,l.SB)()],S.prototype,"isPreloader",void 0),q([(0,l.SB)()],S.prototype,"isPosted",void 0),q([(0,l.SB)()],S.prototype,"noteId",void 0),q([(0,l.SB)()],S.prototype,"pageId",void 0),q([(0,l.Lj)("data-id")],S.prototype,"id",void 0),q([(0,l.Lj)("data-flag")],S.prototype,"flag",null),S=q([(0,l.Qr)("inscriptum-editor")],S)},5708:(t,e,o)=>{o.r(e),o.d(e,{default:()=>n});var i=o(3445);const n=(t,e)=>i.dy`
${t.styles}

<loading-progress-bar .config=${t.loaderConfig} .ref=${t.loadingRef}></loading-progress-bar>

<um-preloader ?loading=${t.isPreloader}>
  <div class="tl_page_wrap">

    <div class="tl_page">
      <section class="tl_article">
        <header class="tl_article_header">
          <h1 dir="auto"></h1>
          <address dir="auto">
            <a rel="author"></a>
            <time datetime=""></time>
          </address>
        </header>
        <article id="_tl_editor" class="tl_article_content">
          <p><br></p>
        </article>
        ${t.tooltip}
        <aside class="tl_article_buttons">
          <div class="account account_top"></div>
          <a id="_edit_button" class="button edit_button">Edit</a>
          <button @click=${e.publish} class="button publish_button">Publish</button>
          <div class="account account_bottom"></div>
          <div id="_error_msg" class="error_msg"></div>
        </aside>
      </section>
    </div>
  </div>
</um-preloader>

<div id="_tl_alerts" class="tl_alerts"></div>
`}}]);