(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{218:function(e,t,r){"use strict";r.r(t),r.d(t,"DraftComponent",function(){return D});r(216),r(214);var n=r(212),i=r(46),a=r(662),c=r(102),s=r(101),o=r(531),l=r(100),d=r.n(l),u=r(217),f=r(559),h=r(663),p=(r(567),r(625));function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t,r,n,i,a,c){try{var s=e[a](c),o=s.value}catch(e){return void r(e)}s.done?t(o):Promise.resolve(o).then(n,i)}function w(){var e=j(["\n    ","\n    <um-preloader loading=",'>\n      <div class="row">\n        <div class="twelve columns um-drafts__submenu">\n          <span @click=',' class="um-drafts__export-all">\n            <i class="far fa-save fa-2x"></i>\n          </span>\n          <button @click=',">Новый черновик</button>\n        </div>\n      </div>\n    \n      <inscriptum-list @action="," .value=","></inscriptum-list>\n    </um-preloader>\n    "]);return w=function(){return e},e}function y(){var e=j(["\n  <style>\n    ","\n  </style>\n"]);return y=function(){return e},e}function j(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var m,g=function(e,t,r,n){var i,a=arguments.length,c=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(c=(a<3?i(c):a>3?i(t,r,c):i(t,r))||c);return a>3&&c&&Object.defineProperty(t,r,c),c};f.b.add(h.a),function(e){e[e.delete=0]="delete",e[e.publish=1]="publish"}(m||(m={}));var D=class extends n.a{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new c.a,t=arguments.length>1?arguments[1]:void 0;super(o.a,!1),this._storageService=e,this._authService=t,this.styles=Object(i.e)(y(),r(549)),this.$={isPreloader:!0},this._authService=new s.a(this._storageService)}connectedCallback(){super.connectedCallback(),this._authService.$authenticated.pipe(Object(u.takeWhile)(()=>void 0===this.$.drafts)).subscribe(e=>{e?this._storageService.allDrafts().then(e=>{var t=e.allDrafts.map(e=>{var{content:t,title:r,image:n}=Object(p.b)(e.contents);return{id:e.id,title:r,image:n,content:t,linkUrl:"/editor/"+e.id,actions:[{label:"удалить",type:m.delete}]}});this.$={isPreloader:!1,drafts:t}}):null!==e&&this._authService.login()}),f.a.watch()}render(){return Object(i.e)(w(),this.styles,this.$.isPreloader,this.handleBtnExportAllDrafts.bind(this),this.handleBtnCreateNewDraft.bind(this),this.handleAction.bind(this),Object(a.a)(this.$.drafts))}handleBtnCreateNewDraft(){var e,t=this;return(e=function*(){var e=yield t._authService.userInfo,r=(yield t._storageService.createDraft(e.name||e.email||"")).createDraft.id;d()("/editor/"+r)},function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){O(a,n,i,c,s,"next",e)}function s(e){O(a,n,i,c,s,"throw",e)}c(void 0)})})()}handleBtnExportAllDrafts(e){e.preventDefault();var t=JSON.stringify(this.$.drafts),r=document.createElement("a"),n=new Blob([t],{type:"application/octet-stream"});r.href=window.URL.createObjectURL(n),r.download="drafts.json",r.click()}handleAction(e){var{detail:t}=e;switch(t.type){case m.delete:this._deleteDraft(t.id)}}_deleteDraft(e){this._storageService.deleteDraft(e).then(e=>{this.$=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(r,!0).forEach(function(t){v(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},this.$,{drafts:this.$.drafts&&this.$.drafts.filter(t=>t.id!==e.deleteDraft.id)})})}};g([Object(n.d)()],D.prototype,"$",void 0),D=g([Object(n.b)("inscriptum-drafts")],D)}}]);