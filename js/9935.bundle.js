"use strict";(self.webpackChunkinscriptum=self.webpackChunkinscriptum||[]).push([[9935,8079,8926,3164,4099,9731,3041,9296,9691,9022,1888,6885,6301],{8079:(e,t,l)=>{l.r(t),l.d(t,{BlockquoteBlot:()=>s});var o=l(5039),i=l(3691);class s extends i.ZP{}s.blotName="blockBlockquote",s.tagName="blockquote",o.Z.register(s)},8926:(e,t,l)=>{l.r(t),l.d(t,{BreakBlot:()=>s});var o=l(5039),i=l(3691);class s extends i.i2{}s.blotName="textBreak",s.tagName="br",s.className="inline",o.Z.register(s)},3164:(e,t,l)=>{l.r(t),l.d(t,{DescriptionBlot:()=>s});var o=l(5039),i=l(9731);class s extends i.FieldBlot{static create(e){console.log("DescriptionBlot create ",e);let t=super.create(e);return t.setAttribute("data-placeholder","Summary of the text"),t.setAttribute("data-label","Description"),t}formatAt(e,t,l,o){console.log("DescriptionBlot formatAt ",e,t,l,o),l===s.blotName?super.formatAt(e,t,l,o):"link"===l&&super.formatAt(0,this.length(),l,o)}format(e,t){console.log("DescriptionBlot format ",e,t),super.format(e,t)}replace(e){console.log("DescriptionBlot replace ",e),super.replace(e)}insertAt(e,t,l){console.log("DescriptionBlot insertAt ",e,t,l),super.insertAt(e,t,l)}}s.blotName="blockDescription",s.tagName="address",o.Z.register(s)},4099:(e,t,l)=>{l.r(t),l.d(t,{DividerBlot:()=>i});var o=l(3691);class i extends o.i2{}i.blotName="blockDivider",i.tagName="hr"},9731:(e,t,l)=>{l.r(t),l.d(t,{FieldBlot:()=>i});var o=l(9022);class i extends o.SingleLineBlot{}},3041:(e,t,l)=>{l.r(t),l.d(t,{HeaderBlot:()=>s});var o=l(5039),i=l(9022);class s extends i.SingleLineBlot{optimize(e){super.optimize(e);let t=this.domNode.innerText;t=t.replace(/[\s_]+/g,"-"),t=t.replace(/(^-+|-+$)/g,""),this.domNode.id!==t&&this.domNode.setAttribute("id",t)}formatAt(e,t,l,o){("bold"!==l&&"italic"!==l&&"code"!==l||!o)&&super.formatAt(e,t,l,o)}}s.blotName="blockHeader",s.tagName="h3",o.Z.register(s)},5622:(e,t,l)=>{l.r(t),l.d(t,{CodeEndLineFlag:()=>n,InsSyntaxCodeBlock:()=>r,InsSyntaxModule:()=>a});var o=l(5039),i=l(1154),s=l(3549);class n extends i.Z{static formats(){return{}}}n.blotName="code-end",n.className="l",n.tagName="SPAN",o.Z.register(n);class r extends s.dn{highlight(e){let t=this.domNode.textContent||"";if(this.cachedText!==t){if(t.trim().length>0||null==this.cachedText){let l="";const o=e(t).split("\n");for(let e=0;e<o.length-1;e++)l+=`<span class="l">${o[e]||" "}</span>\n`;l+=`<span class="l">${o[o.length-1]}</span>`,this.domNode.innerHTML=`<code class="hljs">${l}</code>`}this.cachedText=t}}}class a extends s.ZP{static register(){o.Z.register(s.GW,!0),o.Z.register(r,!0)}highlight(){if(this.quill.selection.composing)return;this.quill.update(o.Z.sources.USER);let e=this.quill.getSelection();this.quill.scroll.descendants(r).forEach((e=>{e.highlight(this.options.highlight)})),this.quill.update(o.Z.sources.SILENT),null!=e&&document.activeElement===this.quill.container.querySelector("[contenteditable]")&&this.quill.setSelection(e,o.Z.sources.SILENT)}}},7466:(e,t,l)=>{l.r(t),l.d(t,{LinkBlot:()=>s});var o=l(1154),i=l(6136);class s extends o.Z{constructor(e,t){super(e),this.value=t,e.addEventListener("mouseover",s.showLinkTooltip.bind(this,this),!1),e.addEventListener("mouseout",s.hideLinkTooltip,!1)}static create(e){let t=super.create(e);e=this.sanitize(e),t.setAttribute("href",e);var l=e.substr(0,1);return"/"!=l&&"#"!=l&&"tg://"!=e.substr(0,5)&&"mailto:"!=e.substr(0,7)&&t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){const t=s.relativeUrl(e);return(0,i.sanitize)(e,["http","https","tg","mailto"])?t:"about:blank"}detach(){this.domNode.removeEventListener("mouseover",s.showLinkTooltip.bind(this,this),!1),this.domNode.removeEventListener("mouseout",s.hideLinkTooltip,!1),super.detach(),s.hideLinkTooltip()}format(e,t){if(e!==this.statics.blotName||!t)return super.format(e,t);t=s.sanitize(t),this.domNode.setAttribute("href",t),this.domNode.setAttribute("data-title",t)}static relativeUrl(e){let t=location,l=document.createElement("a");return l.href=e,t.origin!==l.origin?l.href:t.pathname!==l.pathname||t.search!==l.search?l.pathname+l.search+l.hash:t.href===l.href?l.hash||l.pathname+l.search+l.hash:l.hash}}},1428:(e,t,l)=>{l.r(t),l.d(t,{ListContinuer:()=>i});var o=l(9244);class i extends o.Z{static create(e){let t;return"string"==typeof e?t=super.create(e):(t=super.create(e.type),void 0!==e.start&&(t.setAttribute("start",e.start),t.style["counter-reset"]=`list-0 ${e.start}`)),t}static formats(e){let t=super.formats(e);return console.log("MyList-static.formats",t,e.getAttribute("start")),{type:t,start:e.getAttribute("start")}}}},9296:(e,t,l)=>{l.r(t),l.d(t,{MyQuill:()=>i});var o=l(5039);class i extends o.Z{formatLine(...e){super.formatLine(...e),this.updateSelection()}formatText(...e){super.formatText(...e),this.updateSelection()}updateSelection(e){if(this.hasFocus()){e=e||i.sources.SILENT;let t=this.getSelection(!0);this.setSelection(++t.index,t.length,e),this.setSelection(--t.index,t.length,e)}}}},9691:(e,t,l)=>{l.r(t),l.d(t,{PullquoteBlot:()=>s});var o=l(5039),i=l(3691);class s extends i.ZP{}s.blotName="blockPullquote",s.tagName="aside",o.Z.register(s)},9022:(e,t,l)=>{l.r(t),l.d(t,{SingleLineBlot:()=>r});var o=l(3691),i=l(8926),s=l(347),n=l.n(s);class r extends o.ZP{replace(e){e.children.forEach((e=>{e instanceof i.BreakBlot&&e.replaceWith(n().create("text"," "))})),super.replace(e)}insertAt(e,t,l){void 0!==l&&"textBreak"==t?super.insertAt(e,"\n"):super.insertAt(e,t,l)}}},1888:(e,t,l)=>{l.r(t),l.d(t,{SubheaderBlot:()=>s});var o=l(5039),i=l(3041);class s extends i.HeaderBlot{}s.blotName="blockSubheader",s.tagName="h4",o.Z.register(s)},6885:(e,t,l)=>{l.r(t),l.d(t,{TitleBlot:()=>s});var o=l(5039),i=l(9731);class s extends i.FieldBlot{static create(e){let t=super.create(e);return t.setAttribute("data-placeholder","Title"),t.setAttribute("data-label","Title"),t}formatAt(e,t,l,o){l===s.blotName&&super.formatAt(e,t,l,o)}}s.blotName="blockTitle",s.tagName="h1",o.Z.register(s)},6301:(e,t,l)=>{l.r(t),l.d(t,{default:()=>u});var o=l(637),i=l(9622),s=l(2247),n=l(4085),r=l(1042),a=l(836),c=l(6167),d=l(5688);o.Z.registerLanguage("javascript",i.Z),o.Z.registerLanguage("typescript",s.Z),o.Z.registerLanguage("sql",n.Z),o.Z.registerLanguage("xml",r.Z),o.Z.registerLanguage("css",a.Z),o.Z.registerLanguage("bash",c.Z),o.Z.registerLanguage("yaml",d.Z);const u=o.Z},9935:(e,t,l)=>{l.r(t),l.d(t,{browser:()=>I,editor:()=>P});var o=l(9303),i=l.n(o),s=l(8895),n=l.n(s),r=l(3691),a=l(5039),c=l(9244),d=l(1428),u=l(7443),h=l(2415),g=l(8952),m=l(1812),f=l(8079),p=l(8926),b=l(9731),k=l(7466),S=l(9296),y=l(9691),v=l(9022),x=l(6885),L=l(6681),Z=l(3164),_=l(9733),B=l(3881),E=l(3041),T=l(1888),N=l(5622),q=l(3549),A=l(6136),w=l(6301),C=l(4099);let R=navigator.userAgent.toLowerCase(),I={opera:/opera/i.test(R)||/opr/i.test(R),msie:/msie/i.test(R)&&!/opera/i.test(R)||/trident\//i.test(R)||/edge/i.test(R),msie_edge:/edge/i.test(R)&&!/opera/i.test(R),mozilla:/firefox/i.test(R),chrome:/chrome/i.test(R)&&!/edge/i.test(R),safari:!/chrome/i.test(R)&&/webkit|safari|khtml/i.test(R),iphone:/iphone/i.test(R),ipod:/ipod/i.test(R),ipad:/ipad/i.test(R),android:/android/i.test(R),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(R),safari_mobile:/iphone|ipod|ipad/i.test(R),opera_mobile:/opera mini|opera mobi/i.test(R),opera_mini:/opera mini/i.test(R),mac:/mac/i.test(R)};function P(e,t){console.log(S.MyQuill.length),console.log(S.MyQuill.imports["formats/"]),k.LinkBlot.blotName="link",k.LinkBlot.tagName="a",k.LinkBlot.showLinkTooltip=t=>{e.showLinkTooltip(t,t.value,(0,A.isEdit)(),j)},k.LinkBlot.hideLinkTooltip=()=>e.hideLinkTooltip(j),S.MyQuill.register(k.LinkBlot,!0),L.FigureBlot.blotName="blockFigure",L.FigureBlot.tagName="figure",L.FigureBlot.quillSetSelection=(e,t=0)=>j.setSelection(e,t,a.Z.sources.USER),L.FigureBlot.quillDeleteText=(e,t,l=a.Z.sources.USER)=>j.deleteText(e,t,l),L.FigureBlot.quillInsertText=(e,t)=>j.insertText(e,t,a.Z.sources.USER),L.FigureBlot.draftSave=()=>(0,A.draftSave)(l,j),S.MyQuill.register(L.FigureBlot,!0),S.MyQuill.register(C.DividerBlot),S.MyQuill.register({"modules/syntax":N.InsSyntaxModule,"formats/bold":_.Z,"formats/italic":B.Z,"formats/indent":u.a,"formats/list":d.ListContinuer,"formats/list-item":c.H,"formats/code":h.E,"formats/strike":g.Z},!0);var l=!1;I.mobile&&document.body.classList.add("mobile");let o=document.querySelector(".tl_article"),s=document.querySelector(".tl_article_header"),R=document.querySelector(".tl_article_content"),P=document.querySelector("#_bold_button"),F=document.querySelector("#_italic_button"),U=document.querySelector("#_link_button"),D=document.querySelector("#_header_button"),H=document.querySelector("#_subheader_button"),$=document.querySelector("#_quote_button"),M=document.querySelector("#_strike_button"),z=document.querySelector("#_image_button"),K=document.querySelector("#_embed_button");document.querySelector(".account");var j=new S.MyQuill(t,{scrollingContainer:"html, body",readOnly:!0,modules:{syntax:{highlight:e=>w.default.highlightAuto(e).value},clipboard:{matchers:[O("h2",{blockHeader:!0}),O("h5",{blockSubheader:!0}),O("h6",{blockSubheader:!0}),["img",function(e,t){return e.src&&(0,A.sanitize)(e.src,["http","https","data"])?(new(n())).insert({blockFigure:{image:e.src,caption:e.alt||""}}):new(n())}],["video",function(e,t){return e.src&&(0,A.sanitize)(e.src,["http","https","data"])?(new(n())).insert({blockFigure:{video:e.src}}):new(n())}],["br",function(e,t){return console.log("modules.clipboard.matchers.br"),e.classList.contains("inline")?(new(n())).insert({textBreak:!0}):t}]]},keyboard:{bindings:{"required enter":{key:m.Z.keys.ENTER,collapsed:!0,shiftKey:null,format:["blockTitle","blockDescription"],suffix:/^$/,handler:function(e,t){console.log("keyboard.bindings.required_enter.handler");let[l]=this.quill.scroll.descendant(b.FieldBlot,e.index);return!(l&&l.next&&l.next.domNode&&!l.next.domNode.textContent)||(this.quill.setSelection(l.next.offset(this.quill.scroll),0,a.Z.sources.USER),!1)}},"required tab prev":{key:m.Z.keys.TAB,shiftKey:!0,handler:function(e,t){console.log("keyboard.bindings.required_tab_prev.handler");let l=null;if(e.length>0){let t=j.scroll.descendants(r.ZP,e.index,e.length);if(1!=t.length)return!0;l=t[0]}else[l]=j.scroll.descendant(r.ZP,e.index);if(null!=l&&null!=l.prev&&l.prev instanceof b.FieldBlot){let e=l.prev.offset(j.scroll),t=l.prev.length();return j.setSelection(e,t>1?t:0,a.Z.sources.USER),!1}return!0}},"required tab next":{key:m.Z.keys.TAB,shiftKey:!1,handler:function(e,t){console.log("keyboard.bindings.required_tab_next.handler");let l=null;if(e.length>0){let t=j.scroll.descendants(r.ZP,e.index,e.length);if(1!=t.length)return!0;l=t[0]}else[l]=j.scroll.descendant(r.ZP,e.index);if(null!=l&&l instanceof b.FieldBlot&&null!=l.next){let e=l.next.offset(j.scroll);if(l.next instanceof b.FieldBlot){let t=l.next.length();j.setSelection(e,t>1?t:0,a.Z.sources.USER)}else j.setSelection(e,0,a.Z.sources.USER);return!1}return!0}},"no tab":{key:m.Z.keys.TAB,shiftKey:null,handler:function(e,t){return console.log("keyboard.bindings.no_tab.handler"),!1}},"detect embed":{key:m.Z.keys.ENTER,collapsed:!0,handler:function(t,l){console.log("keyboard.bindings.detect_embed.handler");let[o,i]=j.scroll.line(t.index);if(o){let l,s=o.domNode.textContent.substr(0,i);if(l=s.match(/(^|\s)(https?:\/\/\S+)$/)){let r=l[2];if(j.scroll.descendants(k.LinkBlot,t.index-r.length,r.length).length||j.formatText(t.index-r.length,r.length,"link",r,a.Z.sources.USER),!s.substr(0,i-r.length).trim().length&&"P"==o.domNode.tagName){let t=Y(r);if(t){let l=o.offset(j.scroll);return j.updateContents((new(n())).retain(l).delete(s.length).insert({blockFigure:t}),a.Z.sources.USER),e.hideBlocksTooltip(),!1}}}}return!0}},"divider autofill":{key:m.Z.keys.ENTER,collapsed:!0,prefix:/^([-*])\1{2,}$/,handler:function(e,t){console.log("keyboard.bindings.divider_autofill.handler");let[l,o]=j.scroll.line(e.index);if(l&&"P"==l.domNode.tagName){let e=l.offset(j.scroll),t=(new(n())).retain(e).delete(l.length()).insert({blockDivider:!0});return l.next||t.insert("\n"),j.updateContents(t,a.Z.sources.USER),!1}return!0}},break:{key:m.Z.keys.ENTER,shiftKey:!0,handler:G.bind(null,!0)},enter:{key:m.Z.keys.ENTER,handler:G.bind(null,!1)},"detect link":{key:" ",collapsed:!0,handler:function(e){console.log("detectLinkHandler",e);let[t,l]=j.scroll.line(e.index);if(t){let o,i=t.domNode.textContent.substr(0,l);if(o=i.match(/(^|\s)((?:https?|tg):\/\/\S+|www\.\S+)$/)){let t=o[2],l=t.length;"www."==t.substr(0,4)&&(t="http://"+t),j.scroll.descendants(k.LinkBlot,e.index-l,l).length||j.formatText(e.index-l,l,"link",t,a.Z.sources.USER)}}return!0}},"cancel placeholder":{key:m.Z.keys.ESCAPE,handler:function(e,t){return console.log("keyboard.bindings.cancel_placeholder.handler"),X(),this.quill.updateSelection(a.Z.sources.USER),!0}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{list:!1,"code-block":!1,blockquote:!1,header:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(e,t){if(this.quill.scroll.query&&null==this.quill.scroll.query("list"))return!0;const{length:l}=t.prefix,[o,i]=this.quill.getLine(e.index);if(i>l)return!0;let s;switch(t.prefix.trim()){case"[]":case"[ ]":s="unchecked";break;case"[x]":s="checked";break;case"-":case"*":s="bullet";break;default:s={type:"ordered",start:Number(t.prefix.slice(0,-1))-1}}this.quill.insertText(e.index," ",a.Z.sources.USER),this.quill.history.cutoff(),console.log("keyboard.bindings.list_autofill.handler",e,t);const r=(new(n())).retain(e.index-i).delete(l+1).retain(o.length()-2-i).retain(1,{list:s,start:s.start});console.log("keyboard.bindings.list_autofill.handler",r);const c=this.quill.updateContents(r,a.Z.sources.USER);return console.log("keyboard.bindings.list_autofill.handler",c),this.quill.history.cutoff(),this.quill.setSelection(e.index-l,a.Z.sources.SILENT),!1}},"pre wrap":{key:192,collapsed:!0,format:{"code-block":!1},prefix:/^``$/,offset:2,handler:function(e,t){console.log("keyboard.bindings.pre_wrap.handler");let l=t.prefix.length,o=e.index-l;this.quill.scroll.deleteAt(o,l),this.quill.formatLine(o,1,"code-block",!0,a.Z.sources.USER),this.quill.setSelection(o,a.Z.sources.SILENT)}},code:{key:192,handler:function(e,t){if(console.log("keyboard.bindings.code.handler",!t.format),!t.collapsed){let l=j.scroll.descendants(r.ZP,e.index,e.length);if(l.length>1||1==l.length&&l[0]instanceof q.dn)return this.quill.format("code-block",!t.format["code-block"],a.Z.sources.USER),!1;if(j.scroll.descendants(p.BreakBlot,e.index,e.length).length)return this.quill.format("code-block",!t.format["code-block"],a.Z.sources.USER),!1}if(t.collapsed&&!t.format.code&&!/\s$/.test(t.prefix))return!0;this.quill.format("code",!t.format.code,a.Z.sources.USER)}},"figure delete":{key:m.Z.keys.BACKSPACE,collapsed:!0,offset:0,handler:function(e,t){console.log("keyboard.bindings.figure_delete.handler");let[l,o]=j.scroll.line(e.index);return!(l&&l.prev&&l.prev instanceof L.FigureBlot)||(t.empty&&j.deleteText(e.index,1,a.Z.sources.USER),j.setSelection(l.prev.offset(j.scroll)),!1)}},"field backspace":{key:m.Z.keys.BACKSPACE,collapsed:!0,offset:0,handler:function(e,t){console.log("keyboard.bindings.field_backspace.handler");let[l,o]=j.scroll.line(e.index);return!(l&&l.prev&&l.prev instanceof b.FieldBlot&&l.domNode.textContent.length>0)}},strikethrough:{key:"X",shortKey:!0,shiftKey:!0,handler:function(e,t){j.formatText(e,"strike",!t.format.strike)}}}}}});function O(e,t){return[e,function(e,l){return l.compose((new(n())).retain(l.length(),t))}]}function Q(e){let t=function(e){let[t,l]=j.scroll.line(e);return j.getText(e,t.length()-l)}(e);return!t||"\n"==t}function G(e,t,l){console.log("breakHandler",e,t,l);let o,i=t.index;t.length>0&&j.scroll.deleteAt(i,t.length);let s=Q(i),n=!1;return[o]=j.scroll.descendant(p.BreakBlot,i),o?(!o.prev||o.prev instanceof p.BreakBlot)&&(j.scroll.deleteAt(--i,1),n=!0):([o]=j.scroll.descendant(p.BreakBlot,i-1),o&&(j.scroll.deleteAt(--i,1),n=!0)),[o]=j.scroll.descendant(v.SingleLineBlot,i),o||n||!e?(j.insertText(i,"\n",a.Z.sources.USER),j.setSelection(++i,0,a.Z.sources.USER),(l.format.blockHeader||l.format.blockSubheader||l.format.blockBlockquote||l.format.blockPullquote)&&s&&j.formatLine(i,1,{blockHeader:!1,blockSubheader:!1,blockBlockquote:!1,blockPullquote:!1},a.Z.sources.USER)):(j.insertEmbed(i,"textBreak",!0,a.Z.sources.USER),[o]=j.scroll.descendant(p.BreakBlot,i),!o||o.next||o.prev&&o.prev instanceof p.BreakBlot||(j.insertEmbed(++i,"textBreak",!0,a.Z.sources.SILENT),j.setSelection(i,0,a.Z.sources.SILENT))),!1}function W(e){let t=null==e?{}:j.getFormat(e),l=!!t.blockDescription,o=!(!t.blockHeader&&!t.blockSubheader),i=!!t["code-block"];if(P.classList.toggle("active",!!t.bold),P.classList.toggle("disabled",l||o||i),F.classList.toggle("active",!!t.italic),F.classList.toggle("disabled",l||o||i),D.classList.toggle("active",!!t.blockHeader),D.classList.toggle("disabled",l),H.classList.toggle("active",!!t.blockSubheader),H.classList.toggle("disabled",l),$.classList.toggle("active",!(!t.blockBlockquote&&!t.blockPullquote)),$.classList.toggle("pullquote",!!t.blockPullquote),$.classList.toggle("disabled",l),M.classList.toggle("active",!!t.strike),M.classList.toggle("disabled",l),null!=e){let t=j.scroll.descendants(k.LinkBlot,e.index,e.length);U.classList.toggle("active",!!t.length)}else U.classList.toggle("active",!1);U.classList.toggle("disabled",i)}function Y(e){let t;if((t=e.match(/^(https?):\/\/(www\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/i))||(t=e.match(/^(https?):\/\/(www\.)?youtu\.be\/([a-zA-Z0-9_-]+)/i)))return{embed:"/embed/youtube?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(www\.)?vimeo\.com\/(\d+)/i))return{embed:"/embed/vimeo?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(www\.|mobile\.)?twitter\.com\/(.+)\/status\/(\d+)/i))return{embed:"/embed/twitter?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(t\.me|telegram\.me|telegram\.dog)\/([a-zA-Z0-9_]+)\/(\d+)/i))return{embed:"/embed/telegram?url="+encodeURIComponent(e)};if(t=e.match(/^data:(image\/gif|image\/jpe?g|image\/png|video\/mp4);base64,(.*)$/))return"video/"==t[1].substr(0,6)?{video:e}:{image:e};if(t=e.match(/^(https?):\/\/\S+/i)){let l=document.createElement("a");if(l.href=e,l.pathname.match(/\.(jpe?g|png|gif|mp4)$/i))return"mp4"==t[1]?{video:e}:{image:e}}return!1}function X(){const e=document.querySelector(".placeholder_once");null!==e&&(e.removeAttribute("data-placeholder"),e.classList.remove("placeholder_once","empty"))}function V(e){e.scroll.descendants(r.ZP,0,e.scroll.length()).forEach((e=>{if(e.domNode.hasAttribute("data-placeholder")){let t=e.domNode.textContent;e.domNode.classList.toggle("empty",!t)}}))}function J(e){let[t,l]=e.scroll.lines();if(t instanceof r.i2)e.updateContents((new(n())).insert("\n",{blockTitle:!0}).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT);else if(t instanceof x.TitleBlot||e.formatLine(0,1,{blockTitle:!0},a.Z.sources.SILENT),l){if(l instanceof r.i2){let t=l.offset(e.scroll);e.updateContents((new(n())).retain(t).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT)}else if(!(l instanceof Z.DescriptionBlot)){let t=l.offset(e.scroll);e.formatLine(t,1,{blockDescription:!0},a.Z.sources.SILENT)}}else{let t=e.scroll.length();e.updateContents((new(n())).retain(t).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT)}let[,,o]=e.scroll.lines();if(o){let t=o.offset(e.scroll),l=e.scroll.length()-t;e.scroll.descendants(b.FieldBlot,t,l).forEach((t=>{let l=t.offset(e.scroll),o=t.length(),i=t.constructor.blotName;e.formatText(l,o,i,!1,a.Z.sources.SILENT)}))}else{let t=e.scroll.length();e.insertText(t,"\n",a.Z.sources.SILENT)}let i=e.scroll.lines();i.forEach(((e,t)=>{"P"==e.domNode.tagName&&(3==i.length&&2==t?e.domNode.setAttribute("data-placeholder","Your story..."):e.domNode.removeAttribute("data-placeholder"))}))}function ee(e,t){(t=t||{}).close_btn=t.close_btn||"OK",t.submit_btn=t.submit_btn||!1,t.close=t.close||te,t.submit=t.submit||t.close,te();var l=document.createElement("div");l.classList.add("tl_alert"),l.innerHTML='<main class="tl_alert_message"><section></section><aside class="tl_message_buttons"></aside></main>',l.querySelector("section").innerHTML=e;var o=l.querySelector("aside");if(t.close_btn){var i=document.createElement("button");i.classList.add("button"),i.innerHTML=t.close_btn,i.addEventListener("click",t.close),i.append(o)}if(t.submit_btn){var s=document.createElement("button");s.classList.add("button"),s.innerHTML=t.submit_btn,s.addEventListener("click",(function(){l.classList.add("tl_alert_loading"),t.submit()})),s.append(o)}l.append("body")}function te(){const e=document.querySelector(".tl_alert");e&&e.remove()}function le(e){let t=e.querySelector(".prompt_input"),l=e.querySelector(".close");t.onkeydown=null,t.onblur=null,l.onclick=null,e.style.display="",e.classList.remove("tooltip_prompt"),j.focus()}return j.addContainer(e.$tl_link_tooltip),j.addContainer(e.$tl_tooltip),j.addContainer(e.$tl_blocks),j.on(a.Z.events.EDITOR_CHANGE,(function(t,l){if(t!==a.Z.events.SELECTION_CHANGE)return;if(!j.isEnabled())return;if(null==l)return;!function(t){let[l]=j.scroll.descendant(L.FigureBlot,t.index);j.scroll.descendants(L.FigureBlot,0,j.scroll.length()).forEach((e=>{l!==e&&e.blur()})),l&&(l.focus(),e.hideFormatTooltip(j),e.hideBlocksTooltip())}(l);let[i,s]=j.scroll.descendant(r.ZP,l.index);0===l.length?(e.hideFormatTooltip(j),null==i||i instanceof b.FieldBlot||i instanceof f.BlockquoteBlot||i instanceof y.PullquoteBlot||i instanceof q.dn||i instanceof c.H||""!==i.domNode.textContent?e.hideBlocksTooltip():e.showBlocksTooltip(l,(0,A.isEdit)(),j)):(null==i||i instanceof x.TitleBlot?e.hideFormatTooltip(j):(e.showFormatTooltip(l,j,(0,A.isEdit)()),W(l)),e.hideBlocksTooltip());let n=j.getFormat(l);o&&o.classList.toggle("title_focused",!(!n.blockTitle&&!n.blockDescription)),X()})),j.on(a.Z.events.TEXT_CHANGE,(function(){j.getSelection();J(j),V(j),X(),(0,A.draftSave)(l,j)})),j.on(a.Z.events.SCROLL_OPTIMIZE,(function(e){e.forEach((e=>{if("childList"==e.type&&!e.addedNodes.length&&e.removedNodes.length){let t=e.previousSibling,l=e.nextSibling;if(!l&&t&&"BR"==t.tagName&&"inline"==t.className){let t=document.createElement("br");t.className="inline",e.target.appendChild(t)}else!l||!t||"BR"==t.tagName&&"inline"==t.className||"BR"!=l.tagName||"inline"!=l.className||l.nextSibling||l.parentNode&&l.parentNode.removeChild(l)}}))})),j.scroll.domNode.setAttribute("dir","auto"),document.addEventListener("click touchstart",(function(t){let l=t.target;for(;l;){if(l===j.container)return;l=l.parentNode}e.hideFormatTooltip(j),e.hideBlocksTooltip()})),J(j),V(j),function(){const t={page_id:A.T.pageId};t.save_hash&&(A.T.saveHash=t.save_hash);if(!A.T.pageId&&(o&&o.classList.add("tl_article_edit"),!function(){if(!A.T.pageId)return function(e){try{return localStorage.getItem(e)}catch(e){return!1}}("draft");return!1}()&&t.author_name)){let e;e=t.author_url?{link:t.author_url}:{};let[l]=j.scroll.descendants(Z.DescriptionBlot);l&&j.updateContents((new(n())).retain(l.offset()).delete(l.length()).insert(t.author_name,e),a.Z.sources.USER)}if(t.auth_alert&&t.short_name){var i="Success! You are now logged in as <b>"+(t.short_name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;").replace(/%/g,"&#37;")+"</b> in this browser.");t.migrate_count>0&&t.migrate_hash?(i+="<br/><br/>",ee(i+="We can also add "+t.migrate_count+" Telegraph page"+(t.migrate_count>1?"s":"")+" from this browser to your account.",{close_btn:"Skip",submit_btn:"Add",submit:function(){var e;e=t.migrate_hash,console.log(e)}})):ee(i)}l=(0,A.getPageContent)(!0,j),(0,A.updateEditable)((0,A.isEdit)(),j,e,o,R,s)}(),P.onclick=e=>{console.log("$bold_button.onclick");let t=e.target.classList.contains("active");e.preventDefault(),console.log("$bold_button.onclick",!t),j.format("bold",!t),console.log("$bold_button.onclick",j.getSelection(!0)),j.updateSelection(a.Z.sources.API)},F.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault(),j.format("italic",!t),j.updateSelection(a.Z.sources.API)},U.onclick=t=>{let l=t.target.classList.contains("active");t.preventDefault();var o=j.getSelection(!0);if(l){j.scroll.descendants(k.LinkBlot,o.index,o.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,"link",!1)})),W(o)}else!function(e,t,l){let o=e.querySelector(".prompt_input"),i=e.querySelector(".close");o.value="",o.setAttribute("placeholder",t),o.onkeydown=t=>{let i=t.which||t.keyCode;if(27==i)le(e);else if(13==i){let i=o.value;i&&(l&&l(i),t.preventDefault()),le(e)}},o.onblur=()=>{le(e)},i.onclick=()=>{le(e)},e.style.display="",e.classList.add("tooltip_prompt"),o.focus()}(e.$tl_tooltip,"Paste or type a link...",(function(e){"#"!=(e=e.trim()).substr(0,1)&&"/"!=e.substr(0,1)&&"http://"!=e.substr(0,7)&&"https://"!=e.substr(0,8)&&"tg://"!=e.substr(0,5)&&"mailto:"!=e.substr(0,7)&&(e=e.indexOf("@")>0?"mailto:"+e:"http://"+e),j.focus(),j.format("link",e),W(o)}))},D.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault();let l=j.getSelection(!0);j.format("blockHeader",!t),j.scroll.descendants(E.HeaderBlot,l.index,l.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,{bold:!1,italic:!1,code:!1},a.Z.sources.SILENT)})),j.updateSelection(a.Z.sources.API)},H.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault();let l=j.getSelection(!0);j.format("blockSubheader",!t),j.scroll.descendants(T.SubheaderBlot,l.index,l.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,{bold:!1,italic:!1,code:!1},a.Z.sources.SILENT)})),j.updateSelection(a.Z.sources.API)},$.onclick=e=>{let t=e.target,l=t.classList.contains("active"),o=t.classList.contains("pullquote");e.preventDefault();j.getSelection(!0);l?j.format("blockPullquote",!o):j.format("blockBlockquote",!0),j.updateSelection(a.Z.sources.API)},M.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault(),j.format("strike",!t),j.updateSelection(a.Z.sources.API)},z.onclick=()=>{let e=j.container.querySelector("input.ql-image[type=file][data-status=ready]");null==e&&(e=document.createElement("input"),e.setAttribute("type","file"),e.setAttribute("accept",I.safari_mobile?"image/gif, image/jpeg, image/jpg, image/png":"image/gif, image/jpeg, image/jpg, image/png, video/mp4"),e.classList.add("ql-image"),e.addEventListener("change",(()=>{if(e&&null!=e.files&&null!=e.files[0]){var t=e.files[0];const l=function(){(0,A.showError)("File too big (up to 5 MB allowed)")},o=5242880;!function(e,t){if("image/jpg"==e.type||"image/jpeg"==e.type)return i()(e,(l=>{if("error"===l.type)t(e);else if(l.toBlob)l.toBlob((function(e){t(e)}),e.type);else{var o=l.toDataURL(e.type),i={type:e.type,base64_data:o.split(",")[1]};t((0,A.uploadDataToBlob)(i))}}),{canvas:!0,orientation:!0});t(e)}(t,(t=>{if(t.size>o)return l&&l();var i=new FileReader;i.onload=function(t){if(t&&null!==t.target){let l=Y(t.target.result);if(l){let e=j.getSelection(!0);j.updateContents((new(n())).retain(e.index).delete(e.length).insert({blockFigure:l}),a.Z.sources.USER)}else(0,A.showError)("Invalid file format");e.value="",e.setAttribute("data-status","ready")}},i.readAsDataURL(t)}))}})),j.container.appendChild(e)),e.setAttribute("data-status","busy"),e.click()},K.onclick=t=>{let l=j.getSelection(!0),[o]=j.scroll.line(l.index);const i=o.domNode;if(o){i.textContent||(i.setAttribute("data-placeholder","Paste a YouTube, Vimeo or Twitter link, and press Enter"),i.classList.add("placeholder_once","empty"),e.hideBlocksTooltip())}},window.addEventListener("scroll resize",(()=>{e.tooltipUpdatePosition(e.$tl_tooltip,null,e.formatTTOptions,j),e.tooltipUpdatePosition(e.$tl_link_tooltip,null,e.linkTTOptions,j)})),j}}}]);