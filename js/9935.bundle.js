"use strict";(self.webpackChunkinscriptum=self.webpackChunkinscriptum||[]).push([[9935],{9935:(e,t,l)=>{l.r(t),l.d(t,{browser:()=>I,editor:()=>U});var o=l(9303),n=l.n(o),i=l(8895),s=l.n(i),r=l(3691),a=l(5039),c=l(9244),d=l(1428),u=l(7443),f=l(2415),g=l(8952),m=l(1812),p=l(8079),h=l(8926),b=l(9731),k=l(7466),y=l(9296),S=l(9691),_=l(9022),v=l(6885),E=l(6681),L=l(3164),x=l(9733),T=l(3881),B=l(3041),Z=l(1888),q=l(5622),w=l(3549),N=l(6136),C=l(6301),R=l(4099);let A=navigator.userAgent.toLowerCase(),I={opera:/opera/i.test(A)||/opr/i.test(A),msie:/msie/i.test(A)&&!/opera/i.test(A)||/trident\//i.test(A)||/edge/i.test(A),msie_edge:/edge/i.test(A)&&!/opera/i.test(A),mozilla:/firefox/i.test(A),chrome:/chrome/i.test(A)&&!/edge/i.test(A),safari:!/chrome/i.test(A)&&/webkit|safari|khtml/i.test(A),iphone:/iphone/i.test(A),ipod:/ipod/i.test(A),ipad:/ipad/i.test(A),android:/android/i.test(A),mobile:/iphone|ipod|ipad|opera mini|opera mobi|iemobile|android/i.test(A),safari_mobile:/iphone|ipod|ipad/i.test(A),opera_mobile:/opera mini|opera mobi/i.test(A),opera_mini:/opera mini/i.test(A),mac:/mac/i.test(A)};function U(e,t){console.log(y.MyQuill.length),console.log(y.MyQuill.imports["formats/"]),k.LinkBlot.blotName="link",k.LinkBlot.tagName="a",k.LinkBlot.showLinkTooltip=t=>{e.showLinkTooltip(t,t.value,(0,N.isEdit)(),j)},k.LinkBlot.hideLinkTooltip=()=>e.hideLinkTooltip(j),y.MyQuill.register(k.LinkBlot,!0),E.FigureBlot.blotName="blockFigure",E.FigureBlot.tagName="figure",E.FigureBlot.quillSetSelection=(e,t=0)=>j.setSelection(e,t,a.Z.sources.USER),E.FigureBlot.quillDeleteText=(e,t,l=a.Z.sources.USER)=>j.deleteText(e,t,l),E.FigureBlot.quillInsertText=(e,t)=>j.insertText(e,t,a.Z.sources.USER),E.FigureBlot.draftSave=()=>(0,N.draftSave)(l,j),y.MyQuill.register(E.FigureBlot,!0),y.MyQuill.register(R.DividerBlot),y.MyQuill.register({"modules/syntax":q.InsSyntaxModule,"formats/bold":x.Z,"formats/italic":T.Z,"formats/indent":u.a,"formats/list":d.ListContinuer,"formats/list-item":c.H,"formats/code":f.E,"formats/strike":g.Z},!0);var l=!1;I.mobile&&document.body.classList.add("mobile");let o=document.querySelector(".tl_article"),i=document.querySelector(".tl_article_header"),A=document.querySelector(".tl_article_content"),U=document.querySelector("#_bold_button"),F=document.querySelector("#_italic_button"),P=document.querySelector("#_link_button"),D=document.querySelector("#_header_button"),H=document.querySelector("#_subheader_button"),$=document.querySelector("#_quote_button"),M=document.querySelector("#_strike_button"),K=document.querySelector("#_image_button"),O=document.querySelector("#_embed_button");document.querySelector(".account");var j=new y.MyQuill(t,{scrollingContainer:"html, body",readOnly:!0,modules:{syntax:{highlight:e=>C.default.highlightAuto(e).value},clipboard:{matchers:[z("h2",{blockHeader:!0}),z("h5",{blockSubheader:!0}),z("h6",{blockSubheader:!0}),["img",function(e,t){return e.src&&(0,N.sanitize)(e.src,["http","https","data"])?(new(s())).insert({blockFigure:{image:e.src,caption:e.alt||""}}):new(s())}],["video",function(e,t){return e.src&&(0,N.sanitize)(e.src,["http","https","data"])?(new(s())).insert({blockFigure:{video:e.src}}):new(s())}],["br",function(e,t){return console.log("modules.clipboard.matchers.br"),e.classList.contains("inline")?(new(s())).insert({textBreak:!0}):t}]]},keyboard:{bindings:{"required enter":{key:m.Z.keys.ENTER,collapsed:!0,shiftKey:null,format:["blockTitle","blockDescription"],suffix:/^$/,handler:function(e,t){console.log("keyboard.bindings.required_enter.handler");let[l]=this.quill.scroll.descendant(b.FieldBlot,e.index);return!(l&&l.next&&l.next.domNode&&!l.next.domNode.textContent)||(this.quill.setSelection(l.next.offset(this.quill.scroll),0,a.Z.sources.USER),!1)}},"required tab prev":{key:m.Z.keys.TAB,shiftKey:!0,handler:function(e,t){console.log("keyboard.bindings.required_tab_prev.handler");let l=null;if(e.length>0){let t=j.scroll.descendants(r.ZP,e.index,e.length);if(1!=t.length)return!0;l=t[0]}else[l]=j.scroll.descendant(r.ZP,e.index);if(null!=l&&null!=l.prev&&l.prev instanceof b.FieldBlot){let e=l.prev.offset(j.scroll),t=l.prev.length();return j.setSelection(e,t>1?t:0,a.Z.sources.USER),!1}return!0}},"required tab next":{key:m.Z.keys.TAB,shiftKey:!1,handler:function(e,t){console.log("keyboard.bindings.required_tab_next.handler");let l=null;if(e.length>0){let t=j.scroll.descendants(r.ZP,e.index,e.length);if(1!=t.length)return!0;l=t[0]}else[l]=j.scroll.descendant(r.ZP,e.index);if(null!=l&&l instanceof b.FieldBlot&&null!=l.next){let e=l.next.offset(j.scroll);if(l.next instanceof b.FieldBlot){let t=l.next.length();j.setSelection(e,t>1?t:0,a.Z.sources.USER)}else j.setSelection(e,0,a.Z.sources.USER);return!1}return!0}},"no tab":{key:m.Z.keys.TAB,shiftKey:null,handler:function(e,t){return console.log("keyboard.bindings.no_tab.handler"),!1}},"detect embed":{key:m.Z.keys.ENTER,collapsed:!0,handler:function(t,l){console.log("keyboard.bindings.detect_embed.handler");let[o,n]=j.scroll.line(t.index);if(o){let l,i=o.domNode.textContent.substr(0,n);if(l=i.match(/(^|\s)(https?:\/\/\S+)$/)){let r=l[2];if(j.scroll.descendants(k.LinkBlot,t.index-r.length,r.length).length||j.formatText(t.index-r.length,r.length,"link",r,a.Z.sources.USER),!i.substr(0,n-r.length).trim().length&&"P"==o.domNode.tagName){let t=X(r);if(t){let l=o.offset(j.scroll);return j.updateContents((new(s())).retain(l).delete(i.length).insert({blockFigure:t}),a.Z.sources.USER),e.hideBlocksTooltip(),!1}}}}return!0}},"divider autofill":{key:m.Z.keys.ENTER,collapsed:!0,prefix:/^([-*])\1{2,}$/,handler:function(e,t){console.log("keyboard.bindings.divider_autofill.handler");let[l,o]=j.scroll.line(e.index);if(l&&"P"==l.domNode.tagName){let e=l.offset(j.scroll),t=(new(s())).retain(e).delete(l.length()).insert({blockDivider:!0});return l.next||t.insert("\n"),j.updateContents(t,a.Z.sources.USER),!1}return!0}},break:{key:m.Z.keys.ENTER,shiftKey:!0,handler:G.bind(null,!0)},enter:{key:m.Z.keys.ENTER,handler:G.bind(null,!1)},"detect link":{key:" ",collapsed:!0,handler:function(e){console.log("detectLinkHandler",e);let[t,l]=j.scroll.line(e.index);if(t){let o,n=t.domNode.textContent.substr(0,l);if(o=n.match(/(^|\s)((?:https?|tg):\/\/\S+|www\.\S+)$/)){let t=o[2],l=t.length;"www."==t.substr(0,4)&&(t="http://"+t),j.scroll.descendants(k.LinkBlot,e.index-l,l).length||j.formatText(e.index-l,l,"link",t,a.Z.sources.USER)}}return!0}},"cancel placeholder":{key:m.Z.keys.ESCAPE,handler:function(e,t){return console.log("keyboard.bindings.cancel_placeholder.handler"),V(),this.quill.updateSelection(a.Z.sources.USER),!0}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{list:!1,"code-block":!1,blockquote:!1,header:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(e,t){if(this.quill.scroll.query&&null==this.quill.scroll.query("list"))return!0;const{length:l}=t.prefix,[o,n]=this.quill.getLine(e.index);if(n>l)return!0;let i;switch(t.prefix.trim()){case"[]":case"[ ]":i="unchecked";break;case"[x]":i="checked";break;case"-":case"*":i="bullet";break;default:i={type:"ordered",start:Number(t.prefix.slice(0,-1))-1}}this.quill.insertText(e.index," ",a.Z.sources.USER),this.quill.history.cutoff(),console.log("keyboard.bindings.list_autofill.handler",e,t);const r=(new(s())).retain(e.index-n).delete(l+1).retain(o.length()-2-n).retain(1,{list:i,start:i.start});console.log("keyboard.bindings.list_autofill.handler",r);const c=this.quill.updateContents(r,a.Z.sources.USER);return console.log("keyboard.bindings.list_autofill.handler",c),this.quill.history.cutoff(),this.quill.setSelection(e.index-l,a.Z.sources.SILENT),!1}},"pre wrap":{key:192,collapsed:!0,format:{"code-block":!1},prefix:/^``$/,offset:2,handler:function(e,t){console.log("keyboard.bindings.pre_wrap.handler");let l=t.prefix.length,o=e.index-l;this.quill.scroll.deleteAt(o,l),this.quill.formatLine(o,1,"code-block",!0,a.Z.sources.USER),this.quill.setSelection(o,a.Z.sources.SILENT)}},code:{key:192,handler:function(e,t){if(console.log("keyboard.bindings.code.handler",!t.format),!t.collapsed){let l=j.scroll.descendants(r.ZP,e.index,e.length);if(l.length>1||1==l.length&&l[0]instanceof w.dn)return this.quill.format("code-block",!t.format["code-block"],a.Z.sources.USER),!1;if(j.scroll.descendants(h.BreakBlot,e.index,e.length).length)return this.quill.format("code-block",!t.format["code-block"],a.Z.sources.USER),!1}if(t.collapsed&&!t.format.code&&!/\s$/.test(t.prefix))return!0;this.quill.format("code",!t.format.code,a.Z.sources.USER)}},"figure delete":{key:m.Z.keys.BACKSPACE,collapsed:!0,offset:0,handler:function(e,t){console.log("keyboard.bindings.figure_delete.handler");let[l,o]=j.scroll.line(e.index);return!(l&&l.prev&&l.prev instanceof E.FigureBlot)||(t.empty&&j.deleteText(e.index,1,a.Z.sources.USER),j.setSelection(l.prev.offset(j.scroll)),!1)}},"field backspace":{key:m.Z.keys.BACKSPACE,collapsed:!0,offset:0,handler:function(e,t){console.log("keyboard.bindings.field_backspace.handler");let[l,o]=j.scroll.line(e.index);return!(l&&l.prev&&l.prev instanceof b.FieldBlot&&l.domNode.textContent.length>0)}},strikethrough:{key:"X",shortKey:!0,shiftKey:!0,handler:function(e,t){j.formatText(e,"strike",!t.format.strike)}}}}}});function z(e,t){return[e,function(e,l){return l.compose((new(s())).retain(l.length(),t))}]}function Q(e){let t=function(e){let[t,l]=j.scroll.line(e);return j.getText(e,t.length()-l)}(e);return!t||"\n"==t}function G(e,t,l){console.log("breakHandler",e,t,l);let o,n=t.index;t.length>0&&j.scroll.deleteAt(n,t.length);let i=Q(n),s=!1;return[o]=j.scroll.descendant(h.BreakBlot,n),o?(!o.prev||o.prev instanceof h.BreakBlot)&&(j.scroll.deleteAt(--n,1),s=!0):([o]=j.scroll.descendant(h.BreakBlot,n-1),o&&(j.scroll.deleteAt(--n,1),s=!0)),[o]=j.scroll.descendant(_.SingleLineBlot,n),o||s||!e?(j.insertText(n,"\n",a.Z.sources.USER),j.setSelection(++n,0,a.Z.sources.USER),(l.format.blockHeader||l.format.blockSubheader||l.format.blockBlockquote||l.format.blockPullquote)&&i&&j.formatLine(n,1,{blockHeader:!1,blockSubheader:!1,blockBlockquote:!1,blockPullquote:!1},a.Z.sources.USER)):(j.insertEmbed(n,"textBreak",!0,a.Z.sources.USER),[o]=j.scroll.descendant(h.BreakBlot,n),!o||o.next||o.prev&&o.prev instanceof h.BreakBlot||(j.insertEmbed(++n,"textBreak",!0,a.Z.sources.SILENT),j.setSelection(n,0,a.Z.sources.SILENT))),!1}function Y(e){let t=null==e?{}:j.getFormat(e),l=!!t.blockDescription,o=!(!t.blockHeader&&!t.blockSubheader),n=!!t["code-block"];if(U.classList.toggle("active",!!t.bold),U.classList.toggle("disabled",l||o||n),F.classList.toggle("active",!!t.italic),F.classList.toggle("disabled",l||o||n),D.classList.toggle("active",!!t.blockHeader),D.classList.toggle("disabled",l),H.classList.toggle("active",!!t.blockSubheader),H.classList.toggle("disabled",l),$.classList.toggle("active",!(!t.blockBlockquote&&!t.blockPullquote)),$.classList.toggle("pullquote",!!t.blockPullquote),$.classList.toggle("disabled",l),M.classList.toggle("active",!!t.strike),M.classList.toggle("disabled",l),null!=e){let t=j.scroll.descendants(k.LinkBlot,e.index,e.length);P.classList.toggle("active",!!t.length)}else P.classList.toggle("active",!1);P.classList.toggle("disabled",n)}function X(e){let t;if((t=e.match(/^(https?):\/\/(www\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/i))||(t=e.match(/^(https?):\/\/(www\.)?youtu\.be\/([a-zA-Z0-9_-]+)/i)))return{embed:"/embed/youtube?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(www\.)?vimeo\.com\/(\d+)/i))return{embed:"/embed/vimeo?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(www\.|mobile\.)?twitter\.com\/(.+)\/status\/(\d+)/i))return{embed:"/embed/twitter?url="+encodeURIComponent(e)};if(t=e.match(/^(https?):\/\/(t\.me|telegram\.me|telegram\.dog)\/([a-zA-Z0-9_]+)\/(\d+)/i))return{embed:"/embed/telegram?url="+encodeURIComponent(e)};if(t=e.match(/^data:(image\/gif|image\/jpe?g|image\/png|video\/mp4);base64,(.*)$/))return"video/"==t[1].substr(0,6)?{video:e}:{image:e};if(t=e.match(/^(https?):\/\/\S+/i)){let l=document.createElement("a");if(l.href=e,l.pathname.match(/\.(jpe?g|png|gif|mp4)$/i))return"mp4"==t[1]?{video:e}:{image:e}}return!1}function V(){const e=document.querySelector(".placeholder_once");null!==e&&(e.removeAttribute("data-placeholder"),e.classList.remove("placeholder_once","empty"))}function W(e){e.scroll.descendants(r.ZP,0,e.scroll.length()).forEach((e=>{if(e.domNode.hasAttribute("data-placeholder")){let t=e.domNode.textContent;e.domNode.classList.toggle("empty",!t)}}))}function J(e){let[t,l]=e.scroll.lines();if(t instanceof r.i2)e.updateContents((new(s())).insert("\n",{blockTitle:!0}).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT);else if(t instanceof v.TitleBlot||e.formatLine(0,1,{blockTitle:!0},a.Z.sources.SILENT),l){if(l instanceof r.i2){let t=l.offset(e.scroll);e.updateContents((new(s())).retain(t).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT)}else if(!(l instanceof L.DescriptionBlot)){let t=l.offset(e.scroll);e.formatLine(t,1,{blockDescription:!0},a.Z.sources.SILENT)}}else{let t=e.scroll.length();e.updateContents((new(s())).retain(t).insert("\n",{blockDescription:!0}),a.Z.sources.SILENT)}let[,,o]=e.scroll.lines();if(o){let t=o.offset(e.scroll),l=e.scroll.length()-t;e.scroll.descendants(b.FieldBlot,t,l).forEach((t=>{let l=t.offset(e.scroll),o=t.length(),n=t.constructor.blotName;e.formatText(l,o,n,!1,a.Z.sources.SILENT)}))}else{let t=e.scroll.length();e.insertText(t,"\n",a.Z.sources.SILENT)}let n=e.scroll.lines();n.forEach(((e,t)=>{"P"==e.domNode.tagName&&(3==n.length&&2==t?e.domNode.setAttribute("data-placeholder","Your story..."):e.domNode.removeAttribute("data-placeholder"))}))}function ee(e,t){(t=t||{}).close_btn=t.close_btn||"OK",t.submit_btn=t.submit_btn||!1,t.close=t.close||te,t.submit=t.submit||t.close,te();var l=document.createElement("div");l.classList.add("tl_alert"),l.innerHTML='<main class="tl_alert_message"><section></section><aside class="tl_message_buttons"></aside></main>',l.querySelector("section").innerHTML=e;var o=l.querySelector("aside");if(t.close_btn){var n=document.createElement("button");n.classList.add("button"),n.innerHTML=t.close_btn,n.addEventListener("click",t.close),n.append(o)}if(t.submit_btn){var i=document.createElement("button");i.classList.add("button"),i.innerHTML=t.submit_btn,i.addEventListener("click",(function(){l.classList.add("tl_alert_loading"),t.submit()})),i.append(o)}l.append("body")}function te(){const e=document.querySelector(".tl_alert");e&&e.remove()}function le(e){let t=e.querySelector(".prompt_input"),l=e.querySelector(".close");t.onkeydown=null,t.onblur=null,l.onclick=null,e.style.display="",e.classList.remove("tooltip_prompt"),j.focus()}return j.addContainer(e.$tl_link_tooltip),j.addContainer(e.$tl_tooltip),j.addContainer(e.$tl_blocks),j.on(a.Z.events.EDITOR_CHANGE,(function(t,l){if(t!==a.Z.events.SELECTION_CHANGE)return;if(!j.isEnabled())return;if(null==l)return;!function(t){let[l]=j.scroll.descendant(E.FigureBlot,t.index);j.scroll.descendants(E.FigureBlot,0,j.scroll.length()).forEach((e=>{l!==e&&e.blur()})),l&&(l.focus(),e.hideFormatTooltip(j),e.hideBlocksTooltip())}(l);let[n,i]=j.scroll.descendant(r.ZP,l.index);0===l.length?(e.hideFormatTooltip(j),null==n||n instanceof b.FieldBlot||n instanceof p.BlockquoteBlot||n instanceof S.PullquoteBlot||n instanceof w.dn||n instanceof c.H||""!==n.domNode.textContent?e.hideBlocksTooltip():e.showBlocksTooltip(l,(0,N.isEdit)(),j)):(null==n||n instanceof v.TitleBlot?e.hideFormatTooltip(j):(e.showFormatTooltip(l,j,(0,N.isEdit)()),Y(l)),e.hideBlocksTooltip());let s=j.getFormat(l);o&&o.classList.toggle("title_focused",!(!s.blockTitle&&!s.blockDescription)),V()})),j.on(a.Z.events.TEXT_CHANGE,(function(){j.getSelection();J(j),W(j),V(),(0,N.draftSave)(l,j)})),j.on(a.Z.events.SCROLL_OPTIMIZE,(function(e){e.forEach((e=>{if("childList"==e.type&&!e.addedNodes.length&&e.removedNodes.length){let t=e.previousSibling,l=e.nextSibling;if(!l&&t&&"BR"==t.tagName&&"inline"==t.className){let t=document.createElement("br");t.className="inline",e.target.appendChild(t)}else!l||!t||"BR"==t.tagName&&"inline"==t.className||"BR"!=l.tagName||"inline"!=l.className||l.nextSibling||l.parentNode&&l.parentNode.removeChild(l)}}))})),j.scroll.domNode.setAttribute("dir","auto"),document.addEventListener("click touchstart",(function(t){let l=t.target;for(;l;){if(l===j.container)return;l=l.parentNode}e.hideFormatTooltip(j),e.hideBlocksTooltip()})),J(j),W(j),function(){const t={page_id:N.T.pageId};t.save_hash&&(N.T.saveHash=t.save_hash);if(!N.T.pageId&&(o&&o.classList.add("tl_article_edit"),!function(){if(!N.T.pageId)return function(e){try{return localStorage.getItem(e)}catch(e){return!1}}("draft");return!1}()&&t.author_name)){let e;e=t.author_url?{link:t.author_url}:{};let[l]=j.scroll.descendants(L.DescriptionBlot);l&&j.updateContents((new(s())).retain(l.offset()).delete(l.length()).insert(t.author_name,e),a.Z.sources.USER)}if(t.auth_alert&&t.short_name){var n="Success! You are now logged in as <b>"+(t.short_name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\'/g,"&#39;").replace(/%/g,"&#37;")+"</b> in this browser.");t.migrate_count>0&&t.migrate_hash?(n+="<br/><br/>",ee(n+="We can also add "+t.migrate_count+" Telegraph page"+(t.migrate_count>1?"s":"")+" from this browser to your account.",{close_btn:"Skip",submit_btn:"Add",submit:function(){var e;e=t.migrate_hash,console.log(e)}})):ee(n)}l=(0,N.getPageContent)(!0,j),(0,N.updateEditable)((0,N.isEdit)(),j,e,o,A,i)}(),U.onclick=e=>{console.log("$bold_button.onclick");let t=e.target.classList.contains("active");e.preventDefault(),console.log("$bold_button.onclick",!t),j.format("bold",!t),console.log("$bold_button.onclick",j.getSelection(!0)),j.updateSelection(a.Z.sources.API)},F.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault(),j.format("italic",!t),j.updateSelection(a.Z.sources.API)},P.onclick=t=>{let l=t.target.classList.contains("active");t.preventDefault();var o=j.getSelection(!0);if(l){j.scroll.descendants(k.LinkBlot,o.index,o.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,"link",!1)})),Y(o)}else!function(e,t,l){let o=e.querySelector(".prompt_input"),n=e.querySelector(".close");o.value="",o.setAttribute("placeholder",t),o.onkeydown=t=>{let n=t.which||t.keyCode;if(27==n)le(e);else if(13==n){let n=o.value;n&&(l&&l(n),t.preventDefault()),le(e)}},o.onblur=()=>{le(e)},n.onclick=()=>{le(e)},e.style.display="",e.classList.add("tooltip_prompt"),o.focus()}(e.$tl_tooltip,"Paste or type a link...",(function(e){"#"!=(e=e.trim()).substr(0,1)&&"/"!=e.substr(0,1)&&"http://"!=e.substr(0,7)&&"https://"!=e.substr(0,8)&&"tg://"!=e.substr(0,5)&&"mailto:"!=e.substr(0,7)&&(e=e.indexOf("@")>0?"mailto:"+e:"http://"+e),j.focus(),j.format("link",e),Y(o)}))},D.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault();let l=j.getSelection(!0);j.format("blockHeader",!t),j.scroll.descendants(B.HeaderBlot,l.index,l.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,{bold:!1,italic:!1,code:!1},a.Z.sources.SILENT)})),j.updateSelection(a.Z.sources.API)},H.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault();let l=j.getSelection(!0);j.format("blockSubheader",!t),j.scroll.descendants(Z.SubheaderBlot,l.index,l.length).forEach((e=>{let t=e.offset(j.scroll),l=e.length();j.formatText(t,l,{bold:!1,italic:!1,code:!1},a.Z.sources.SILENT)})),j.updateSelection(a.Z.sources.API)},$.onclick=e=>{let t=e.target,l=t.classList.contains("active"),o=t.classList.contains("pullquote");e.preventDefault();j.getSelection(!0);l?j.format("blockPullquote",!o):j.format("blockBlockquote",!0),j.updateSelection(a.Z.sources.API)},M.onclick=e=>{let t=e.target.classList.contains("active");e.preventDefault(),j.format("strike",!t),j.updateSelection(a.Z.sources.API)},K.onclick=()=>{let e=j.container.querySelector("input.ql-image[type=file][data-status=ready]");null==e&&(e=document.createElement("input"),e.setAttribute("type","file"),e.setAttribute("accept",I.safari_mobile?"image/gif, image/jpeg, image/jpg, image/png":"image/gif, image/jpeg, image/jpg, image/png, video/mp4"),e.classList.add("ql-image"),e.addEventListener("change",(()=>{if(e&&null!=e.files&&null!=e.files[0]){var t=e.files[0];const l=function(){(0,N.showError)("File too big (up to 5 MB allowed)")},o=5242880;!function(e,t){if("image/jpg"==e.type||"image/jpeg"==e.type)return n()(e,(l=>{if("error"===l.type)t(e);else if(l.toBlob)l.toBlob((function(e){t(e)}),e.type);else{var o=l.toDataURL(e.type),n={type:e.type,base64_data:o.split(",")[1]};t((0,N.uploadDataToBlob)(n))}}),{canvas:!0,orientation:!0});t(e)}(t,(t=>{if(t.size>o)return l&&l();var n=new FileReader;n.onload=function(t){if(t&&null!==t.target){let l=X(t.target.result);if(l){let e=j.getSelection(!0);j.updateContents((new(s())).retain(e.index).delete(e.length).insert({blockFigure:l}),a.Z.sources.USER)}else(0,N.showError)("Invalid file format");e.value="",e.setAttribute("data-status","ready")}},n.readAsDataURL(t)}))}})),j.container.appendChild(e)),e.setAttribute("data-status","busy"),e.click()},O.onclick=t=>{let l=j.getSelection(!0),[o]=j.scroll.line(l.index);const n=o.domNode;if(o){n.textContent||(n.setAttribute("data-placeholder","Paste a YouTube, Vimeo or Twitter link, and press Enter"),n.classList.add("placeholder_once","empty"),e.hideBlocksTooltip())}},window.addEventListener("scroll resize",(()=>{e.tooltipUpdatePosition(e.$tl_tooltip,null,e.formatTTOptions,j),e.tooltipUpdatePosition(e.$tl_link_tooltip,null,e.linkTTOptions,j)})),j}}}]);