(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{616:function(t,e,i){"use strict";i.r(e),i.d(e,"FigureBlot",function(){return p});i(644),i(214);var r=i(552),s=i(551),a=i(574),o=i(651),n=i.n(o),d=i(617),l=i(564);function u(t,e,i,r,s,a,o){try{var n=t[a](o),d=n.value}catch(t){return void i(t)}n.done?e(d):Promise.resolve(d).then(r,s)}class p extends s.a{constructor(t,e){super(t),this.domNode=t,this.domWrapper=document.createElement("div"),this.domCursor=document.createElement("span"),this.domCaption=document.createElement("figcaption"),this.domWrapper.classList.add("figure_wrapper"),this.domCursor.classList.add("cursor_wrapper"),this.domCursor.setAttribute("contenteditable","true"),this.domCaption.classList.add("editable_text"),this.domCaption.setAttribute("data-placeholder","Caption (optional)"),e.caption&&(this.domCaption.innerText=e.caption),this.domNode.appendChild(this.domWrapper),this.domNode.appendChild(this.domCursor),this.domNode.appendChild(this.domCaption),setTimeout(()=>{Object(l.updateEditableText)(this.domNode)},1);var i=!1;e.image?(this.appendImgNode(e.image),i=this.uploadData(e.image)):e.video?(this.appendVideoNode(e.video),i=this.uploadData(e.video)):e.embed&&this.appendIframeNode(e.embed),i&&(this.domProgress=document.createElement("div"),this.domProgressBar=document.createElement("div"),this.domProgress.classList.add("file_progress"),this.domProgressBar.classList.add("file_progress_bar"),this.domWrapper.classList.add("loading"),this.domProgress.appendChild(this.domProgressBar),this.domWrapper.appendChild(this.domProgress),this.uploadFile(i)),this.domWrapper.onclick=()=>{if(!this.domNode.classList.contains("focus")){var t=this.offset(this.scroll);this.focus(),p.quillSetSelection(t)}},this.domCursor.onkeydown=t=>{var e=t.which||t.keyCode;if(e==a.a.keys.BACKSPACE){var i=this.offset(this.scroll);p.quillDeleteText(i,this.length()),p.quillSetSelection(i-1),t.preventDefault()}else if(e==a.a.keys.ENTER){var r=this.offset(this.scroll)+this.length();this.focus(),p.quillInsertText(r,"\n"),p.quillSetSelection(r),t.preventDefault()}},this.domCursor.onpaste=t=>{t.stopPropagation(),t.preventDefault()},this.domCaption.onkeydown=t=>{var e=t.which||t.keyCode,i=t.target;if(e==a.a.keys.ENTER){if(t.shiftKey)return;var r={start:i.selectionStart,end:i.selectionEnd},s=i.value;if(r.start!=r.end)s=s.substr(0,r.start)+s.substr(r.end),i.setSelectionRange(s.length,s.length);else if(r.end==s.length){var o=this.offset(this.scroll)+this.length();this.focus(),p.quillInsertText(o,"\n"),p.quillSetSelection(o)}t.preventDefault()}else if(e==a.a.keys.DOWN||e==a.a.keys.TAB||e==a.a.keys.RIGHT){var n={start:i.selectionStart,end:i.selectionEnd},d=i.value;if(n.start==n.end&&n.end==d.length){var l=this.offset(this.scroll)+this.length();this.focus(),p.quillSetSelection(l,0),t.preventDefault()}}else if(e==a.a.keys.LEFT||e==a.a.keys.UP){var u={start:i.selectionStart,end:i.selectionEnd};if(u.start==u.end&&0===u.start){var h=this.offset(this.scroll)-1;this.focus(),p.quillSetSelection(h,0),t.preventDefault()}}};var r=t=>{null!==t&&null!==t.target&&(this.domCaption.classList.toggle("empty",!t.target.value),n.a.update(t.target),p.draftSave())};this.domCaption.onpaste=t=>{t.stopPropagation(),r(t)},this.domCaption.onkeyup=r,this.domCaption.ondrop=r,this.domCaption.onchange=r,this.domCaption.oninput=r,this.domCaption.oncut=r,this.domCaption.onclick=t=>{t.target&&t.target.focus()}}static create(t){var e=super.create(t);return e.setAttribute("contenteditable","false"),e}appendImgNode(t){var e=document.createElement("img");return e.setAttribute("src",this.sanitize(t)),this.domWrapper.appendChild(e),e}appendVideoNode(t){var e=document.createElement("video");return e.setAttribute("src",this.sanitize(t)),e.setAttribute("preload","auto"),e.setAttribute("controls","controls"),e.addEventListener("loadeddata",function(){this.mozHasAudio||this.webkitAudioDecodedByteCount||this.audioTracks&&this.audioTracks.length||(this.setAttribute("autoplay","autoplay"),this.setAttribute("loop","loop"),this.setAttribute("muted","muted"),this.removeAttribute("controls"),this.play())}),this.domWrapper.appendChild(e),e}appendIframeNode(t){var e=document.createElement("div"),i=document.createElement("div"),r=document.createElement("iframe");return e.classList.add("iframe_wrap"),e.appendChild(i),i.classList.add("iframe_helper"),i.style.paddingTop="56.25%",i.appendChild(r),r.setAttribute("src",this.sanitize(t)),r.setAttribute("width","640"),r.setAttribute("height","360"),r.setAttribute("frameborder","0"),r.setAttribute("allowtransparency","true"),r.setAttribute("allowfullscreen","true"),r.setAttribute("scrolling","no"),this.domWrapper.appendChild(e),e}uploadFile(t){this.uploadFileStart(t,(t,e)=>{var i=0;e&&t&&(i=100*t/e,i=Math.min(100,i)),this.domProgressBar.style.width=i+"%"},e=>{if(e){var i=this.sanitize(e.src);if("video/"==t.type.substr(0,6)){var r=this.domWrapper.querySelector("video");r&&r.setAttribute("src",i)}else{var s=this.domWrapper.querySelector("img");s&&s.setAttribute("src",i)}this.domWrapper.classList.remove("loading"),p.draftSave()}},t=>(p.quillDeleteText(this.offset(this.scroll),this.length(),r.a.sources.SILENT),p.draftSave(),Object(l.showError)(t)))}uploadData(t){var e;return!!(e=t.match(/^data:(image\/gif|image\/jpe?g|image\/png|video\/mp4);base64,(.*)$/))&&{type:e[1],base64_data:e[2]}}sanitize(t){return Object(l.sanitize)(t,["http","https","data"])?t:"//:0"}static value(t){var e={caption:""},i=t.querySelector("img");i&&(e.image=i.src);var r=t.querySelector("video");r&&(e.video=r.src);var s=t.querySelector("iframe");s&&(e.embed=s.src);var a=t.querySelector("figcaption");if(a){var o=a.querySelector(".editable_input");e.caption=o?o.value:a.innerText}return e}focus(){this.domNode.classList.add("focus")}blur(){this.domNode.classList.remove("focus")}_index(t,e){if(t===this.domCaption)return 0;var i=0;return t.nodeType==t.TEXT_NODE&&(i+=e>=0?e:t.data.length),t.previousSibling?i+this._index(t.previousSibling,-1):t.parentNode?i+this._index(t.parentNode,-1):0}_position(t,e){if(t.nodeType==t.TEXT_NODE)return e<=t.data.length?[t,e]:[null,e-=t.data.length];for(var i=t.firstChild;i;){var r=null;if([r,e]=this._position(i,e),r)return[r,e];i=i.nextSibling}return[t,e]}update(t){this.domCursor.innerHTML=""}index(t,e){return 0}position(t,e){return[this.domCursor,0]}uploadFileStart(t,e,i,r){return(s=function*(){try{var s=yield Object(d.uploadFileService)(Object(l.uploadDataToBlob)(t),e);i&&i(s)}catch(t){r&&r("Network error")}},function(){var t=this,e=arguments;return new Promise(function(i,r){var a=s.apply(t,e);function o(t){u(a,i,r,o,n,"next",t)}function n(t){u(a,i,r,o,n,"throw",t)}o(void 0)})})();var s}}},644:function(t,e,i){"use strict";var r=i(29),s=i(213),a=i(538),o=i(536);i(537)("match",1,function(t,e,i,n){return[function(i){var r=t(this),s=null==i?void 0:i[e];return void 0!==s?s.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=n(i,t,this);if(e.done)return e.value;var d=r(t),l=String(this);if(!d.global)return o(d,l);var u=d.unicode;d.lastIndex=0;for(var p,h=[],c=0;null!==(p=o(d,l));){var m=String(p[0]);h[c]=m,""===m&&(d.lastIndex=a(l,s(d.lastIndex),u)),c++}return 0===c?null:h}]})}}]);